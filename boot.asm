%include "bios.h"
%include "fat.h"

	[BITS 16]
	[ORG BOOT_ENTRY + 64]

	JMP 0:CORRECTION
CORRECTION:
	MOV AX, CS
	MOV ES, AX
	MOV SS, AX
	MOV DS, AX
	MOV SP, BOOT_ENTRY
	
	MOV SI, ENTRYSTR
	CALL PRINT

	MOV SI, OEM_IDENT
	CALL PRINT

	CLI
	HLT

PRINT:
	PUSHA
	MOV AH, PUTCHAR
PRINTLOOP:
	LODSB
	OR AL, AL
	JZ ENDPRINT
	INT TEXT_SERVICE
	JMP PRINTLOOP
ENDPRINT:
	POPA
	RET

ENTRYSTR: DB "Dosile boot started.", 13, 10, 0

	TIMES 510 - 64 - ($ - $$) DB 0
	DW BOOT_SIGNATURE
